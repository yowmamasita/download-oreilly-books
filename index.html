<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Download O'Reilly Books</title>
  <meta name="description" content="How-to guide on downloading O'Reilly books, videos and other content">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="theme-color" content="#fafafa">
</head>

<body>

  <h1>Download O'Reilly Books</h1>
  
  <p>This seems to NOT work with Firefox. Please use other browsers if you face any problems.</p>
  
  <h3>This tool let you download a cookies.json file from a cURL request to O'Reilly which allows you to authenticate and download books using the tool <a target="_blank" href="https://github.com/lorenzodifuccia/safaribooks">github.com/lorenzodifuccia/safaribooks</a>.</h3>  
  
  <ol>
    <li>Login as usual to <a target="_blank" href="https://learning.oreilly.com/">https://learning.oreilly.com/</a></li>
    <li>Open the developer tools with F12</li>
    <li>Go to Network tab in the developer tools</li>
    <li>Access the profile page in the browser: <a target="_blank" href="https://learning.oreilly.com/profile/">https://learning.oreilly.com/profile/</a></li>
    <li>In the Network tab, click on the request to /profile/ (it should be the first one)</li>
    <li>Right click that > Copy > Copy as cURL (Copy as cURL (bash) in Windows)</li>
    <li>Paste the results below and click the Download button</li>
  </ol>
  
  <textarea id="request"></textarea>
  
  <button onclick="downloadCookieJsonFile()">Download cookies.json</button>
  
  <a href="https://github.com/yowmamasita/download-oreilly-books">Download O'Reilly Books</a>
  
  <script>
    const getCookies = curlText => curlText.match(/'cookie: (.*)' \\/)[1]
    const cookie2Json = (cookieText) => {
      const output = {}
      cookieText.split(/; /).forEach(function (pair) {
        pair = pair.split(/\s*=\s*/)
        output[pair[0]] = pair.splice(1).join('=')
      })
      return JSON.stringify(output, null, 4) 
    }
    const download = (filename, text) => {
      const element = document.createElement('a')
      element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }

    window.downloadCookieJsonFile = () => {
      const input = document.querySelector("#request").value
      const cookies = getCookies(input)
      const json = cookie2Json(cookies)
      download('cookies.json', json)
    }
  </script>

</body>

</html>
